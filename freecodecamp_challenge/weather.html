<!DOCTYPE html>
<html>

<head></head>

<body>
  <div id="temp"></div>
  <div id="hTemp"></div>
  <div id="lTemp"></div>
  <div id="desc"></div>
  <script>
    window.onload = function() {

      var view = {
        displayWeather: (temp, hTemp, lTemp, desc) => {
          document.getElementById('temp').innerHTML = temp;
          document.getElementById('hTemp').innerHTML = hTemp;
          document.getElementById('lTemp').innerHTML = lTemp;
          document.getElementById('desc').innerHTML = desc;
        },

        displayCity: (city) => {
          document.getElementById('city').innerHTML = city;
        }
      }

      var model = {
        lat: null,
        long: null,
        celsius: {
          temp: null,
          hTemp: null,
          lTemp: null,
          desc: null
        },
        getGeolocation: function() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(this.success, this.fail);
          } else {
            alert("geolocation is not supported");
          }
        },
        success: (position) => {
          this.lat = position.coords.latitude;
          console.log(this.lat);
          this.long = position.coords.longitude;
        },
        fail: () => {
          alert("fail")
        },
        getWeather: () => {
          var response;
          var request = new XMLHttpRequest;
          var url = 'https://fcc-weather-api.glitch.me/api/current?lat=' + this.lat + '&lon=' + this.long;
          request.open('GET', url);
          request.onload = function() {
            if (request.status == 200) {
              response = JSON.parse(request.responseText);
              // this.celsiustemp = response.main.temp;
              // this.celsius.hTemp = response.main.temp_max;
              // this.celsius.lTemp = response.main.temp_min;
              // this.celsius.desc = response.weather[0].main;
              // var iconID = response.weather[0].id;
              // view.displayWeather(this.celsius.temp, this.celsius.hTemp, this.celsius.lTemp, this.celsius.desc);
              // var temp = response.main.temp;
              // var hTemp = response.main.temp_max;
              // var lTemp = response.main.temp_min;
              // var desc = response.weather[0].main;;
              // view.displayWeather(temp, hTemp, lTemp, desc);
            } else {
              alert('Request failed');
            }
          }
          request.send(null);
        },

        getCity: () => {
          var request = new XMLHttpRequest();
          var url = "https://maps.googleapis.com/maps/api/geocode/json?latlng=" + this.lat + "," + this.long + "&key=AIzaSyAa3ISQTUoVs3kfaFu-Wtub7IlfMBVTDgM";
          request.open("GET", url);
          request.onload = function() {
            if (request.status == 200) {
              var city = JSON.parse(request.responseText).results[0].address_components[4].short_name;
              view.displayCity(city);
            } else {
              alert('City request failed');
            }
          };
          request.send(null);
        },
        changeTempUnit: (e) => {
          if (e.target.innerHTML === "&#8457;") {
            view.displayWeather(this.celsius.temp, this.celsius.hTemp, this.celsius.lTemp, this.celsius.desc);
          } else {}
          var tempF = this.celsius.temp * 9 / 5 + 32;
          var hTempF = this.celsius.hTemp * 9 / 5 + 32;
          var lTempF = this.celsius.lTemp * 9 / 5 + 32;
          view.displayWeather(tempF, hTempF, lTempF, this.celsius.desc);
        }
      }



      model.getGeolocation();
      // model.getWeather();
      // model.getCity();
      // document.getElementById('toggle-uni-tn').onclick = model.changeTempUnit;
    }
  </script>
</body>

</html>